(function () {
	console.log("Adapt Framework - loading...");

	if (!window.$) {
		//SUPPORT FOR V1.1.1 JQUERY SWAPPING >
		//Test for ie8
	    var IE = (function() { 
	        if (document.documentMode) {
	            return document.documentMode;
	        }
	        return false;
	    })();

	    //Load jquery
        Modernizr.load([
            {
                test: IE == 8,
                yep: 'libraries/jquery.js',
                nope: 'libraries/jquery.v2.js',
                complete: loadAdapt
            }
        ]);
        //< SUPPORT FOR V1.1.1 JQUERY SWAPPING
	} else loadAdapt();


	function loadAdapt() {

		require.config({
			baseUrl: "./", //FIX FOR MODERNIZER BASEURL CHANGES
			paths: {
				libraries: "adapt/js/libraries",
				core: "adapt/js/core",
				bundles: "adapt/js/bundles",
				templates: "adapt/js/templates",
			},
			map: {
				'*': {
					"a11y": "jquery.a11y", //FIX FOR MISNAMED JQUERY.A11Y LIBRARY
					'coreJS/libraries/bowser': 'bowser', //FIX FOR MISREFERENCED BOWSER LIBRARY
					'components/components': 'bundles', //REDIRECT OLD GRUNT BUILD LIBRARY 
					'extensions/extensions': 'bundles', //REDIRECT OLD GRUNT BUILD LIBRARY
					'theme/theme': 'bundles', //REDIRECT OLD GRUNT BUILD LIBRARY
					'menu/menu': 'bundles', //REDIRECT OLD GRUNT BUILD LIBRARY
			        }
		        },
			shim: {
				'templates': [
					'libraries'
				],
				'core': [
					'libraries',
					'templates'
				],
				'bundles': [
					'libraries',
					'core',
					'templates'
				]
			},
			waitSeconds: 20
		});

		require.onError = function(err) {
			alert(err);
		};

		require([
			'bundles'
		], function() {
			console.log("Adapt Framework - libraries, templates, core and plugins loaded");
		});
	}

})();
